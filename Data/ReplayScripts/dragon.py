import math
import g

#local
def init_scene():
    g.set_duration(0.0)
    g.set_renderer("ClearView (Unified)")
    g.set_mesh("2015 - Practical Hex-Mesh Optimization via Edge-Cone Rectification", "dragon_out", "mesh")
    g.set_transfer_function("Standard_dragon.xml")
    g.set_camera_checkpoint("Overview")
    g.set_rendering_algorithm_settings({
        "line_width": 0.0018,
        "lod_value_context": 0.126,
        "lod_value_focus": 0.192,
        "use_screen_space_lens": True,
        "screen_space_lens_radius": 0.0,
        "screen_space_lens_position": (10.5, 10.5),
        "focus_outline_width": 9.0,
        "clip_focus_outline": False,
        "focus_outline_color": (1.0, 0.0, 0.0),
        "important_lines": 0.457,
        "important_cells": 0.440,
    })
    g.set_duration(2)

def length_vec2(v):
    return math.sqrt(v[0] * v[0] + v[1] * v[1])
def distance_vec2(v0, v1):
    return length_vec2((v0[0] - v1[0], v0[1] - v1[1]))

def move_lens_overview():
    total_time = 42.0
    lens_positions = [
        (-1.0659723333333333, 0.505556),
        (-0.9854163333333333, 0.508333),
        (-0.9145833333333333, 0.513889),
        (-0.8076388333333333, 0.519444),
        (-0.7145833333333333, 0.533333),
        (-0.6048613333333333, 0.529167),
        (-0.5409723333333334, 0.538889),
        (-0.49097233333333334, 0.543056),
        (-0.41458333333333336, 0.540278),
        (-0.36597233333333334, 0.531944),
        (-0.3506943333333333, 0.534722),
        (-0.3368053333333333, 0.488889),
        (-0.32847233333333337, 0.433333),
        (-0.3298613333333334, 0.388889),
        (-0.34513933333333313, 0.343056),
        (-0.36458333333333315, 0.302778),
        (-0.3881943333333333, 0.244444),
        (-0.42708333333333315, 0.177778),
        (-0.45763933333333334, 0.0986111),
        (-0.5062503333333332, 0.0430555),
        (-0.5548613333333334, -0.0375),
        (-0.6076393333333334, -0.120833),
        (-0.6187503333333333, -0.183333),
        (-0.6465273333333335, -0.305556),
        (-0.6326393333333333, -0.368056),
        (-0.6076393333333334, -0.438889),
        (-0.6020833333333333, -0.5),
        (-0.5909723333333333, -0.548611),
        (-0.5493053333333333, -0.548611),
        (-0.5034723333333332, -0.559722),
        (-0.44930533333333345, -0.561111),
        (-0.3923613333333334, -0.572222),
        (-0.31875033333333314, -0.575),
        (-0.24791633333333324, -0.565278),
        (-0.19930533333333358, -0.468056),
        (-0.1256943333333333, -0.398611),
        (-0.07847233333333337, -0.301389),
        (-0.025694333333333298, -0.173611),
        (0.010416666666666666, -0.0555556),
        (0.09930566666666671, 0.0597222),
        (0.16458366666666677, 0.168056),
        (0.22430666666666638, 0.241667),
        (0.3326366666666669, 0.268056),
        (0.44513666666666657, 0.276389),
        (0.5090266666666666, 0.263889),
        (0.5756966666666667, 0.231944),
        (0.6131966666666664, 0.198611),
        (0.6215266666666663, 0.165278),
        (0.6187466666666669, 0.118056),
        (0.6020866666666668, 0.0513889),
        (0.5673566666666668, -0.0319445),
        (0.5173566666666665, -0.108333),
        (0.47569666666666677, -0.195833),
        (0.46319666666666703, -0.258333),
        (0.45902666666666664, -0.316667),
        (0.46041666666666636, -0.375),
        (0.46041666666666636, -0.445833),
        (0.4409766666666665, -0.501389),
        (0.4409766666666665, -0.569444),
        (0.4659766666666665, -0.619444),
        (0.5243066666666667, -0.633333),
        (0.6201366666666666, -0.625),
        (0.7201366666666666, -0.613889),
        (0.846526666666667, -0.588889),
        (0.9284766666666668, -0.472222),
        (0.9409766666666665, -0.305556),
        (0.9506966666666667, -0.1375),
        (0.9506966666666667, -0.0125),
        (0.9534766666666669, 0.0902778)
    ]

    # Move lens to start position.
    g.set_duration(0)
    g.set_rendering_algorithm_settings({ "screen_space_lens_position": lens_positions[0] })
    g.set_duration(2)
    g.set_rendering_algorithm_settings({ "screen_space_lens_radius": 360.0 })
    g.set_duration(2)

    total_length = 0.0
    for i in range(1, len(lens_positions)):
        total_length += distance_vec2(lens_positions[i-1], lens_positions[i])

    for i in range(1, len(lens_positions)):
        curr_distance = distance_vec2(lens_positions[i-1], lens_positions[i])
        g.set_duration(curr_distance * total_time / total_length)
        g.set_rendering_algorithm_settings({ "screen_space_lens_position": lens_positions[i] })

    g.set_duration(4)


def replay():
    init_scene()
    move_lens_overview()
